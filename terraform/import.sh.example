#!/bin/bash
set -euo pipefail

# Transit Gateway Import Script Template
#
# Usage:
#   1. Copy this file: cp import.sh.example import.sh
#   2. Replace placeholder IDs with your actual AWS resource IDs
#   3. Run: ./import.sh
#
# How to get resource IDs:
#   aws ec2 describe-transit-gateways --region <region>
#   aws ec2 describe-transit-gateway-route-tables --region <region>
#   aws ec2 describe-transit-gateway-attachments --region <region>

cd "$(dirname "$0")"

echo "Starting Terraform import for Transit Gateway resources..."
echo "Using for_each resource addressing..."

# Import Transit Gateway
echo "Importing Transit Gateway..."
terraform import 'module.transit_gateway.aws_ec2_transit_gateway.this' tgw-xxxxx

# Import Transit Gateway Route Tables
echo "Importing Transit Gateway Route Tables..."
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table.this["development"]' tgw-rtb-xxxxx
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table.this["production"]' tgw-rtb-yyyyy
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table.this["shared"]' tgw-rtb-zzzzz

# Import VPC Attachments
echo "Importing VPC Attachments..."
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_vpc_attachment.this["vpc1"]' tgw-attach-xxxxx
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_vpc_attachment.this["vpc2"]' tgw-attach-yyyyy

# Import Route Table Associations
echo "Importing Route Table Associations..."
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table_association.this["development_vpc2"]' tgw-rtb-xxxxx_tgw-attach-yyyyy
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table_association.this["production_vpc1"]' tgw-rtb-yyyyy_tgw-attach-xxxxx

# Import Route Table Propagations
echo "Importing Route Table Propagations..."
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table_propagation.this["shared_vpc1"]' tgw-rtb-zzzzz_tgw-attach-xxxxx
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route_table_propagation.this["shared_vpc2"]' tgw-rtb-zzzzz_tgw-attach-yyyyy

# Import Transit Gateway Routes
echo "Importing Transit Gateway Routes..."
# Development routes
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["dev_10_1_0_0_16"]' tgw-rtb-xxxxx_10.1.0.0/16
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["dev_10_1_100_0_24"]' tgw-rtb-xxxxx_10.1.100.0/24
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["dev_192_168_0_0_16_blackhole"]' tgw-rtb-xxxxx_192.168.0.0/16

# Production routes
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["prod_10_2_0_0_16"]' tgw-rtb-yyyyy_10.2.0.0/16
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["prod_10_99_0_0_16_blackhole"]' tgw-rtb-yyyyy_10.99.0.0/16

# Shared routes
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["shared_0_0_0_0_0"]' tgw-rtb-zzzzz_0.0.0.0/0
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["shared_10_1_0_0_16"]' tgw-rtb-zzzzz_10.1.0.0/16
terraform import 'module.transit_gateway.aws_ec2_transit_gateway_route.this["shared_10_2_0_0_16"]' tgw-rtb-zzzzz_10.2.0.0/16

# Import VPC Routes
echo "Importing VPC Routes..."
terraform import 'module.transit_gateway.aws_route.this["vpc1_to_10_2_0_0_16"]' rtb-xxxxx_10.2.0.0/16
terraform import 'module.transit_gateway.aws_route.this["vpc2_to_10_1_0_0_16"]' rtb-yyyyy_10.1.0.0/16

echo "Import complete!"
echo "Run 'terraform plan' to verify the import was successful."
